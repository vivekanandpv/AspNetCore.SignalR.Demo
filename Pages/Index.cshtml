@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>

    <div class="form-group">
        <label>Message</label>
        <input type="text" class="form-control" id="messageInput" />
        <button class="btn btn-primary btn-sm mt-2" id="button">Send</button>
    </div>
</div>

<script>
    var connection
        = new signalR.HubConnectionBuilder()
            .withUrl('/messages')

            //manual strategy
            //.withAutomaticReconnect({
            //    nextRetryDelayInMilliseconds: retryContext => {
            //        if (retryContext.elapsedMilliseconds < 60000) {
            //            // If we've been reconnecting for less than 60 seconds so far,
            //            // wait between 0 and 10 seconds before the next reconnect attempt.
            //            return Math.random() * 10000;
            //        } else {
            //            // If we've been reconnecting for more than 60 seconds so far, stop reconnecting.
            //            return null;
            //        }
            //    }
            //})

            //Automatic strategy
            //.withAutomaticReconnect([0, 2000, 10000, 30000]);   //  this is default

            .build()
            

    connection.on('ReceiveMessage', function (id, message, timestamp) {
        console.log('Message received', id, message, timestamp);
    });

    connection.start();

    var button = document.getElementById('button');
    var input = document.getElementById('messageInput');

    button.addEventListener('click', function () {
        connection.invoke('SendMessageAsync', input.value);
    })
</script>
